{"version":3,"sources":["../../host-ports/services.js"],"sourcesContent":["// services.v1.mjs —— 纯 ESM，浏览器可直接 import\r\nconst REG_KEY = '__SS_SERVICES_SINGLETON__';\r\n\r\n// HMR/多次加载下保持单例\r\nconst REG = (globalThis[REG_KEY] ||= {\r\n    version: 'services@1 link@1 image@1',\r\n    link: null,\r\n    image: null,\r\n});\r\n\r\n/** 覆盖式注册；可被多次调用（HMR 友好） */\r\nexport function register(services) {\r\n    if (services?.link) REG.link = services.link;\r\n    if (services?.image) REG.image = services.image;\r\n    return get(); // 方便链式调试\r\n}\r\n\r\n/** 取全部服务；未就绪时抛清晰错误 */\r\nexport function get() {\r\n    if (!REG.link || !REG.image) {\r\n        const missing = [\r\n            REG.link ? null : 'link',\r\n            REG.image ? null : 'image',\r\n        ].filter(Boolean).join(',');\r\n        throw new Error(`[services] not ready: ${missing}. Call register({ link, image }) first.`);\r\n    }\r\n    return REG;\r\n}\r\n\r\n/** 便捷 API */\r\nexport const getLink = () => get().link;\r\nexport const getImage = () => get().image;\r\nexport const provided = () => ({ link: !!REG.link, image: !!REG.image });\r\nexport const getVersion = () => REG.version;\r\n\r\n// 为了排查“唯一真身”，暴露当前模块 URL\r\nexport const moduleUrl = import.meta.url;\r\n"],"mappings":"AACA,IAAMA,EAAU,4BAGVC,EAAO,WAAWD,CAAO,IAAM,CACjC,QAAS,4BACT,KAAM,KACN,MAAO,IACX,EAGO,SAASE,EAASC,EAAU,CAC/B,OAAIA,GAAU,OAAMF,EAAI,KAAOE,EAAS,MACpCA,GAAU,QAAOF,EAAI,MAAQE,EAAS,OACnCC,EAAI,CACf,CAGO,SAASA,GAAM,CAClB,GAAI,CAACH,EAAI,MAAQ,CAACA,EAAI,MAAO,CACzB,IAAMI,EAAU,CACZJ,EAAI,KAAO,KAAO,OAClBA,EAAI,MAAQ,KAAO,OACvB,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,EAC1B,MAAM,IAAI,MAAM,yBAAyBI,CAAO,yCAAyC,CAC7F,CACA,OAAOJ,CACX,CAGO,IAAMK,EAAU,IAAMF,EAAI,EAAE,KACtBG,EAAW,IAAMH,EAAI,EAAE,MACvBI,EAAW,KAAO,CAAE,KAAM,CAAC,CAACP,EAAI,KAAM,MAAO,CAAC,CAACA,EAAI,KAAM,GACzDQ,EAAa,IAAMR,EAAI,QAGvBS,EAAY,YAAY","names":["REG_KEY","REG","register","services","get","missing","getLink","getImage","provided","getVersion","moduleUrl"]}